<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>meal-plan.ch</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="app">
        <!-- App Header -->
        <header class="app-header">
            <div class="logo">
                <svg class="logo-svg" viewBox="0 0 40 40" width="36" height="36" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="40" height="40" rx="10" fill="rgba(255,255,255,0.15)"/>
                    <!-- Calendar body -->
                    <rect x="8" y="12" width="24" height="20" rx="2.5" stroke="white" stroke-width="1.4" fill="none"/>
                    <!-- Calendar top bar -->
                    <line x1="8" y1="17" x2="32" y2="17" stroke="white" stroke-width="1.4"/>
                    <!-- Calendar rings -->
                    <line x1="14" y1="9" x2="14" y2="14" stroke="white" stroke-width="1.6" stroke-linecap="round"/>
                    <line x1="26" y1="9" x2="26" y2="14" stroke="white" stroke-width="1.6" stroke-linecap="round"/>
                    <!-- Fork -->
                    <path d="M17 20v9" stroke="white" stroke-width="1.3" stroke-linecap="round"/>
                    <path d="M15 20v3.5c0 1 0.9 1.5 2 1.5s2-0.5 2-1.5V20" stroke="white" stroke-width="1.3" stroke-linecap="round" fill="none"/>
                    <line x1="17" y1="20" x2="17" y2="23" stroke="white" stroke-width="1.3" stroke-linecap="round"/>
                    <!-- Knife -->
                    <path d="M23 20v9" stroke="white" stroke-width="1.3" stroke-linecap="round"/>
                    <path d="M23 20c2.2 0 3 1.5 3 3.5s-1 2.5-3 2.5" stroke="white" stroke-width="1.3" stroke-linecap="round" fill="rgba(255,255,255,0.1)"/>
                </svg>
                <div class="logo-text">
                    <span class="logo-name">meal-plan</span><span class="logo-tld">.ch</span>
                </div>
            </div>
            <div id="header-right" class="header-right hidden">
                <button class="btn-invite hidden" id="invite-btn" title="Einladungscode generieren">+Einladen</button>
                <div id="user-badge" class="user-badge">
                    <span id="app-user-name"></span>
                    <button class="btn-logout" id="logout-btn" title="Abmelden">Abmelden</button>
                </div>
            </div>
        </header>

        <!-- Auth Screen -->
        <div id="auth-screen" class="login-screen">
            <div class="login-card">
                <div class="login-logo">
                    <svg viewBox="0 0 56 56" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="56" height="56" rx="14" fill="var(--primary)"/>
                        <!-- Calendar body -->
                        <rect x="11" y="16" width="34" height="29" rx="3.5" stroke="white" stroke-width="1.8" fill="none"/>
                        <!-- Calendar top bar -->
                        <line x1="11" y1="24" x2="45" y2="24" stroke="white" stroke-width="1.8"/>
                        <!-- Calendar rings -->
                        <line x1="20" y1="11" x2="20" y2="18.5" stroke="white" stroke-width="2" stroke-linecap="round"/>
                        <line x1="36" y1="11" x2="36" y2="18.5" stroke="white" stroke-width="2" stroke-linecap="round"/>
                        <!-- Fork -->
                        <path d="M24 27v13" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
                        <path d="M21 27v5c0 1.4 1.3 2.2 3 2.2s3-0.8 3-2.2V27" stroke="white" stroke-width="1.8" stroke-linecap="round" fill="none"/>
                        <line x1="24" y1="27" x2="24" y2="33" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
                        <!-- Knife -->
                        <path d="M32 27v13" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
                        <path d="M32 27c3 0 4.2 2 4.2 4.8s-1.4 3.5-4.2 3.5" stroke="white" stroke-width="1.8" stroke-linecap="round" fill="rgba(255,255,255,0.08)"/>
                    </svg>
                </div>
                <h2>meal-plan.ch</h2>
                <p class="login-subtitle">Melde dich an oder registriere dich</p>
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="auth-login-tab">Anmelden</button>
                    <button class="auth-tab" data-tab="auth-register-tab">Registrieren</button>
                </div>
                <form id="auth-login-form" class="auth-tab-content" data-tab="auth-login-tab">
                    <div class="form-group">
                        <label for="auth-username">Benutzername</label>
                        <input type="text" id="auth-username" placeholder="Benutzername" required>
                    </div>
                    <div class="form-group">
                        <label for="auth-password">Passwort</label>
                        <input type="password" id="auth-password" placeholder="Passwort" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Anmelden</button>
                </form>
                <form id="auth-register-form" class="auth-tab-content hidden" data-tab="auth-register-tab">
                    <div class="form-group">
                        <label for="reg-username">Benutzername</label>
                        <input type="text" id="reg-username" placeholder="Min. 3 Zeichen" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Passwort</label>
                        <input type="password" id="reg-password" placeholder="Min. 6 Zeichen" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-invite">Einladungscode</label>
                        <input type="text" id="reg-invite" placeholder="Code eingeben" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Registrieren</button>
                </form>
                <div id="auth-status" class="status hidden"></div>
            </div>
        </div>

        <!-- Admin Screen -->
        <div id="admin-screen" class="hidden">
            <div class="container">
                <div class="settings-panel">
                    <h3>Einladungscodes</h3>
                    <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 16px;">
                        <button class="btn btn-primary" id="admin-invite-btn" style="width: auto;">Neuer Code</button>
                        <div id="admin-invite-result" class="hidden" style="display: flex; align-items: center; gap: 10px;">
                            <span class="invite-code-display" id="admin-invite-code" style="font-size: 1.2rem; padding: 8px 14px; margin: 0;">---</span>
                            <button class="btn btn-secondary btn-sm" id="admin-copy-btn">Kopieren</button>
                        </div>
                    </div>
                    <div id="admin-invites-list"></div>
                </div>

                <div class="settings-panel" style="margin-top: 16px;">
                    <h3>Benutzer</h3>
                    <div id="admin-users-list"></div>
                </div>
            </div>
        </div>

        <!-- Cookidoo Login Screen -->
        <div id="login-screen" class="login-screen hidden">
            <div class="login-card">
                <h2>Cookidoo verbinden</h2>
                <p class="login-subtitle">Melde dich mit deinem Cookidoo-Konto an, um deine Rezepte und Sammlungen zu laden.</p>
                <form id="login-form">
                    <div class="form-group">
                        <label for="email">E-Mail</label>
                        <input type="email" id="email" placeholder="deine@email.de" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Passwort</label>
                        <input type="password" id="password" placeholder="Passwort" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="country">Land</label>
                            <select id="country">
                                <option value="de">Deutschland</option>
                                <option value="at">&Ouml;sterreich</option>
                                <option value="ch">Schweiz</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="language">Sprache</label>
                            <select id="language">
                                <option value="de-DE">Deutsch (DE)</option>
                                <option value="de-AT">Deutsch (AT)</option>
                                <option value="de-CH">Deutsch (CH)</option>
                            </select>
                        </div>
                    </div>
                    <div class="save-options" style="margin-bottom: 16px; justify-content: flex-start;">
                        <label>
                            <input type="checkbox" id="remember-credentials">
                            Zugangsdaten merken
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary" id="login-btn">Anmelden</button>
                </form>
                <div id="login-status" class="status hidden"></div>
                <div id="forget-credentials-row" class="hidden" style="margin-top: 12px; text-align: center;">
                    <button class="btn btn-secondary btn-sm" id="forget-credentials-btn">Gespeicherte Zugangsdaten vergessen</button>
                </div>
            </div>
        </div>

        <!-- Main App (hidden until login) -->
        <div id="main-app" class="hidden">
            <!-- Versteckt, wird von JS genutzt -->
            <div id="collection-info" class="hidden"></div>

            <!-- Action Bar -->
            <div class="action-bar">
                <div class="action-bar-inner">
                    <div class="action-buttons">
                        <button class="btn-filter" id="filter-btn">
                            <svg viewBox="0 0 20 20" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round">
                                <line x1="3" y1="5" x2="17" y2="5"/>
                                <line x1="6" y1="10" x2="14" y2="10"/>
                                <line x1="9" y1="15" x2="11" y2="15"/>
                            </svg>
                            <span>Filter</span>
                            <span class="filter-badge hidden" id="filter-badge">0</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Plan -->
            <div class="container">
                <section id="plan-section">
                    <div id="plan-grid" class="plan-grid"></div>
                </section>
            </div>

            <!-- Save Bar (fixed bottom) -->
            <div id="save-section" class="save-section hidden">
                <div class="save-options">
                    <div class="form-group">
                        <label for="week-offset">Woche:</label>
                        <select id="week-offset">
                            <option value="0">Diese Woche</option>
                            <option value="1" selected>N&auml;chste Woche</option>
                            <option value="2">&Uuml;bern&auml;chste Woche</option>
                        </select>
                    </div>
                    <label>
                        <input type="checkbox" id="clear-first">
                        Woche vorher leeren
                    </label>
                    <label>
                        <input type="checkbox" id="add-shopping-list">
                        Zutaten zur Einkaufsliste
                    </label>
                </div>
                <button class="btn btn-success" id="save-btn">In Cookidoo speichern</button>
                <div id="save-status" class="status hidden" style="margin: 0; flex-basis: 100%;"></div>
            </div>
        </div>

        <!-- Filter Panel -->
        <div id="filter-panel" class="filter-panel">
            <div class="filter-panel-header">
                <h3>Filter</h3>
                <button class="filter-close-btn" id="filter-close-btn" title="Schliessen">&#x2715;</button>
            </div>
            <div class="filter-panel-body">

                <!-- Kategorie -->
                <div class="filter-panel-section">
                    <label class="filter-panel-label">Kategorie</label>
                    <div class="filter-tags" id="category-filters">
                        <label class="filter-tag active"><input type="checkbox" value="alle" checked> Alle</label>
                        <label class="filter-tag"><input type="checkbox" value="vegetarisch"> Vegetarisch</label>
                        <label class="filter-tag"><input type="checkbox" value="vegan"> Vegan</label>
                        <label class="filter-tag"><input type="checkbox" value="low carb"> Low Carb</label>
                        <label class="filter-tag"><input type="checkbox" value="high protein"> High Protein</label>
                    </div>
                </div>

                <!-- Küche -->
                <div class="filter-panel-section">
                    <label class="filter-panel-label">K&uuml;che</label>
                    <div class="filter-tags" id="cuisine-filters">
                        <label class="filter-tag active"><input type="checkbox" value="alle" checked> Alle</label>
                        <label class="filter-tag"><input type="checkbox" value="italienisch"> Italienisch</label>
                        <label class="filter-tag"><input type="checkbox" value="asiatisch"> Asiatisch</label>
                        <label class="filter-tag"><input type="checkbox" value="mexikanisch"> Mexikanisch</label>
                        <label class="filter-tag"><input type="checkbox" value="indisch"> Indisch</label>
                        <label class="filter-tag"><input type="checkbox" value="mediterran"> Mediterran</label>
                        <label class="filter-tag"><input type="checkbox" value="orientalisch"> Orientalisch</label>
                    </div>
                </div>

                <!-- Sprache -->
                <div class="filter-panel-section">
                    <label class="filter-panel-label">Sprache</label>
                    <div class="filter-tags" id="language-filters">
                        <label class="filter-tag active"><input type="checkbox" value="alle" checked> Alle</label>
                        <label class="filter-tag"><input type="checkbox" value="de"> Deutsch</label>
                        <label class="filter-tag"><input type="checkbox" value="fr"> Fran&ccedil;ais</label>
                        <label class="filter-tag"><input type="checkbox" value="it"> Italiano</label>
                        <label class="filter-tag"><input type="checkbox" value="en"> English</label>
                    </div>
                </div>

                <!-- Max. Kochzeit -->
                <div class="filter-panel-section">
                    <label class="filter-panel-label">Max. Kochzeit</label>
                    <div class="time-filter-slots">
                        <div class="time-filter-slot">
                            <span class="time-slot-label">Mittag</span>
                            <select id="max-time-0">
                                <option value="">Keine Begrenzung</option>
                                <option value="30">30 Min.</option>
                                <option value="45">45 Min.</option>
                                <option value="60">60 Min.</option>
                                <option value="90">90 Min.</option>
                                <option value="120">120 Min.</option>
                            </select>
                        </div>
                        <div class="time-filter-slot">
                            <span class="time-slot-label">Abend</span>
                            <select id="max-time-1">
                                <option value="">Keine Begrenzung</option>
                                <option value="30">30 Min.</option>
                                <option value="45">45 Min.</option>
                                <option value="60">60 Min.</option>
                                <option value="90">90 Min.</option>
                                <option value="120">120 Min.</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Mischverhältnis -->
                <div class="filter-panel-section">
                    <label class="filter-panel-label">Eigene vs. neue Rezepte</label>
                    <input type="range" id="custom-ratio" min="0" max="100" value="70" style="width:100%; margin: 8px 0;">
                    <div class="ratio-display" id="ratio-display">70% eigene / 30% neue</div>
                </div>

                <!-- Zutaten ausschliessen -->
                <div class="filter-panel-section">
                    <label class="filter-panel-label">Zutaten ausschlie&szlig;en</label>
                    <p class="filter-panel-hint">Rezepte mit diesen Zutaten im Titel werden ausgeschlossen.</p>
                    <div class="ingredient-input-wrapper">
                        <div class="ingredient-input-row">
                            <input type="text" id="exclude-ingredient-input" placeholder="z.B. N&uuml;sse, Milch..." autocomplete="off">
                            <button class="btn-add-ingredient" id="add-exclude-btn" title="Hinzuf&uuml;gen">+</button>
                        </div>
                        <div class="ingredient-autocomplete hidden" id="exclude-autocomplete"></div>
                    </div>
                    <div class="ingredient-chips" id="exclude-chips"></div>
                </div>

                <!-- Bevorzugte Zutaten -->
                <div class="filter-panel-section">
                    <label class="filter-panel-label">Bevorzugte Zutaten</label>
                    <p class="filter-panel-hint">Rezepte mit diesen Zutaten werden bevorzugt gesucht.</p>
                    <div class="ingredient-input-wrapper">
                        <div class="ingredient-input-row">
                            <input type="text" id="prefer-ingredient-input" placeholder="z.B. H&auml;hnchen, Tomate..." autocomplete="off">
                            <button class="btn-add-ingredient" id="add-prefer-btn" title="Hinzuf&uuml;gen">+</button>
                        </div>
                        <div class="ingredient-autocomplete hidden" id="prefer-autocomplete"></div>
                    </div>
                    <div class="ingredient-chips" id="prefer-chips"></div>
                </div>

            </div>
            <div class="filter-panel-footer">
                <button class="btn btn-primary" id="filter-apply-btn">Speichern</button>
                <button class="btn btn-secondary hidden" id="filter-reset-btn">Zur&uuml;cksetzen</button>
            </div>
        </div>

        <!-- Filter Backdrop -->
        <div id="filter-backdrop" class="filter-backdrop"></div>

        <!-- Invite Modal -->
        <div id="invite-modal" class="modal-overlay hidden">
            <div class="modal-card">
                <h3>Einladungscode</h3>
                <p>Teile diesen Code mit jemandem, damit er sich registrieren kann:</p>
                <div class="invite-code-display" id="invite-code-display">---</div>
                <button class="btn btn-secondary btn-sm" id="invite-copy-btn">Kopieren</button>
                <button class="btn btn-secondary btn-sm" id="invite-close-btn">Schliessen</button>
            </div>
        </div>

        <!-- Password Reset Modal -->
        <div id="password-modal" class="modal-overlay hidden">
            <div class="modal-card">
                <h3>Passwort zur&uuml;cksetzen</h3>
                <p>Neues Passwort f&uuml;r <strong id="reset-username"></strong>:</p>
                <div class="form-group" style="text-align: left; margin-top: 12px;">
                    <input type="password" id="reset-password" placeholder="Neues Passwort (min. 6 Zeichen)">
                </div>
                <button class="btn btn-primary btn-sm" id="reset-confirm-btn">Speichern</button>
                <button class="btn btn-secondary btn-sm" id="reset-cancel-btn">Abbrechen</button>
                <div id="reset-status" class="status hidden" style="margin-top: 12px;"></div>
            </div>
        </div>

        <!-- Per-Day Filter Popover (Singleton) -->
        <div id="per-day-filter-popover" class="per-day-filter-popover">
            <div class="per-day-filter-header">
                <span id="per-day-filter-title">Filter: Tag</span>
                <button class="per-day-filter-close" id="per-day-filter-close" title="Schlie&szlig;en">&#x2715;</button>
            </div>
            <!-- Meal config section (populated by JS) -->
            <div id="per-day-meal-section" class="per-day-meal-section"></div>
            <div class="per-day-filter-body">
                <div class="form-group">
                    <label>Kategorie</label>
                    <select id="per-day-category">
                        <option value="">Globaler Filter</option>
                        <option value="vegetarisch">Vegetarisch</option>
                        <option value="vegan">Vegan</option>
                        <option value="low carb">Low Carb</option>
                        <option value="high protein">High Protein</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>K&uuml;che</label>
                    <select id="per-day-cuisine">
                        <option value="">Globaler Filter</option>
                        <option value="italienisch">Italienisch</option>
                        <option value="asiatisch">Asiatisch</option>
                        <option value="mexikanisch">Mexikanisch</option>
                        <option value="indisch">Indisch</option>
                        <option value="mediterran">Mediterran</option>
                        <option value="orientalisch">Orientalisch</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Max. Kochzeit</label>
                    <select id="per-day-max-time">
                        <option value="">Globaler Filter</option>
                        <option value="30">30 Min.</option>
                        <option value="45">45 Min.</option>
                        <option value="60">60 Min.</option>
                        <option value="90">90 Min.</option>
                        <option value="120">120 Min.</option>
                    </select>
                </div>
            </div>
            <div class="per-day-filter-footer">
                <button class="btn btn-secondary btn-sm" id="per-day-clear">Zur&uuml;cksetzen</button>
                <button class="btn btn-primary btn-sm" id="per-day-apply">Neu w&uuml;rfeln</button>
            </div>
        </div>
        <div id="per-day-filter-backdrop" class="per-day-filter-backdrop"></div>

        <!-- Globales Card-Aktionsmenü (Singleton, position: fixed) -->
        <div id="card-action-dropdown" class="card-action-dropdown hidden"></div>

        <!-- Loading -->
        <div id="loading" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
            <p id="loading-text">Laden...</p>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
